<?php

header("Access-Control-Allow-Origin: *");

function render($text) {
	return preg_replace('`((?:https?|ftp)://\S+[[:alnum:]]/?)`si',
	      		        '<a href="$1"  target="_blank">$1</a>',
	                    $text);
}

function getName() {
	$name = $_GET['name'];
	return $name;
}

function readEmail() {
	$name = getName();
	$emails = trim(file_get_contents(__DIR__.'/../users/'.$name));
	return explode(PHP_EOL, $emails);
}

function sendEmail() {
	$to = $_POST['to'];
	$from = $_POST['from'];
	$message = $_POST['message'];

	$to = str_replace('@', '', $to);
	$message = str_replace(PHP_EOL, ' ', $message);

	$oldEmails = file_get_contents(__DIR__.'/../users/'.$to);
	$email = $from . ':|:' .$message . ':|:' . date("F j, Y, g:i a");

	$newEmails = $email . PHP_EOL . $oldEmails;
	file_put_contents(__DIR__.'/../users/'.$to, $newEmails);
}